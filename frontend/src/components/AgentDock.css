/* Agent Dock Component Styles
 * Compact bottom-pinned chat panel with transcript, composer, and quick actions
 */

/* ──────────────────────────────────────────
   CSS custom properties (dock-scoped)
   ────────────────────────────────────────── */
:root {
  --dock-header-h: 36px;       /* closed height */
  --dock-open-h: 440px;        /* expanded height on desktop */
  --dock-width: 380px;
  --dock-z: 100;
}

/* ──────────────────────────────────────────
   Main container
   ────────────────────────────────────────── */
.agent-dock {
  position: fixed;
  bottom: 0;
  right: 24px;
  width: var(--dock-width);
  height: var(--dock-open-h);

  display: flex;
  flex-direction: column;
  background: var(--color-surface-1);
  border: 1px solid var(--color-border);
  border-bottom: none;
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  box-shadow: 0 -4px 24px rgba(15, 23, 42, 0.10);
  pointer-events: auto;
  z-index: var(--dock-z);
  transition:
    height var(--duration-fast) var(--easing-standard);
}

.agent-dock.minimized {
  height: var(--dock-header-h);
}

.agent-dock.idle {
  opacity: 0.92;
}

/* ──────────────────────────────────────────
   Header — single compact line
   ────────────────────────────────────────── */
.agent-dock-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 0 10px;
  height: var(--dock-header-h);
  min-height: var(--dock-header-h);
  flex-shrink: 0;
  border-bottom: 1px solid var(--color-border);
  background: var(--color-surface-2);
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  user-select: none;
}

/* Status dot */
.agent-dock-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  flex-shrink: 0;
  background: var(--color-text-tertiary);
  transition: background var(--duration-fast) var(--easing-standard);
}
.agent-dock-dot.live     { background: #22c55e; box-shadow: 0 0 0 2px rgba(34,197,94,0.2); }
.agent-dock-dot.loading,
.agent-dock-dot.connecting { background: #f59e0b; animation: pulse 1.2s ease-in-out infinite; }
.agent-dock-dot.error    { background: var(--color-error); }
.agent-dock-dot.empty    { background: var(--color-text-tertiary); }

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.4; }
}

/* Title */
.agent-dock-title-label {
  font-size: 11px;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.07em;
  white-space: nowrap;
  flex-shrink: 0;
}

/* Activity summary — fills remaining space */
.agent-dock-activity {
  flex: 1;
  font-size: 11px;
  color: var(--color-text-tertiary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
}

/* Inline error text (small, in header) */
.agent-dock-error-inline {
  font-size: 11px;
  color: var(--color-error);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Icon buttons (menu + chevron) */
.agent-dock-icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  padding: 0;
  flex-shrink: 0;
  background: none;
  border: none;
  border-radius: var(--radius-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: color var(--duration-fast) var(--easing-standard),
              background var(--duration-fast) var(--easing-standard);
}
.agent-dock-icon-btn:hover {
  color: var(--color-text-primary);
  background: var(--color-surface-0);
}

/* Chevron rotates when expanded */
.agent-dock-chevron svg {
  transition: transform var(--duration-fast) var(--easing-standard);
}
.agent-dock-chevron.expanded svg {
  transform: rotate(180deg);
}

/* ──────────────────────────────────────────
   Hamburger menu dropdown
   ────────────────────────────────────────── */
.agent-dock-menu-wrap {
  position: relative;
  flex-shrink: 0;
}

.agent-dock-menu {
  position: absolute;
  bottom: calc(100% + 6px);
  right: 0;
  min-width: 210px;
  background: var(--color-surface-1);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
  padding: 6px;
  z-index: calc(var(--dock-z) + 10);
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.agent-dock-menu-section {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 4px 6px 6px;
}

.agent-dock-menu-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--color-text-tertiary);
  font-weight: var(--font-weight-semibold);
}

.agent-dock-menu-select {
  font-size: var(--font-size-xs);
  background: var(--color-surface-0);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  padding: 4px 6px;
  cursor: pointer;
  width: 100%;
}

.agent-dock-menu-divider {
  height: 1px;
  background: var(--color-border);
  margin: 2px 0;
}

.agent-dock-menu-item {
  display: block;
  width: 100%;
  text-align: left;
  font-size: var(--font-size-xs);
  color: var(--color-text-primary);
  background: none;
  border: none;
  border-radius: var(--radius-sm);
  padding: 6px 10px;
  cursor: pointer;
  transition: background var(--duration-fast) var(--easing-standard);
}
.agent-dock-menu-item:hover:not(:disabled) {
  background: var(--color-surface-2);
}
.agent-dock-menu-item:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
.agent-dock-menu-item--danger {
  color: var(--color-error);
}
.agent-dock-menu-item--danger:hover:not(:disabled) {
  background: rgba(220, 38, 38, 0.07);
}

/* ──────────────────────────────────────────
   Body (only visible when expanded)
   ────────────────────────────────────────── */
.agent-dock-body {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

/* ──────────────────────────────────────────
   Empty state
   ────────────────────────────────────────── */
.agent-dock-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
  padding: var(--space-8);
  flex: 1;
  color: var(--color-text-secondary);
}

.agent-dock-empty-icon {
  font-size: var(--font-size-3xl);
  margin: 0;
  opacity: 0.3;
}

.agent-dock-empty-text {
  margin: 0;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
}

.agent-dock-empty-hint {
  margin: 0;
  font-size: var(--font-size-xs);
  text-align: center;
  max-width: 200px;
}

/* ──────────────────────────────────────────
   Loading state
   ────────────────────────────────────────── */
.agent-dock-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-4);
  padding: var(--space-8);
  flex: 1;
}

.agent-dock-spinner {
  width: 28px;
  height: 28px;
  border: 2px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin var(--duration-slower) linear infinite;
}

.agent-dock-loading-text {
  margin: 0;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

/* ──────────────────────────────────────────
   Transcript area
   ────────────────────────────────────────── */
.agent-dock-transcript-area {
  flex: 1;
  min-height: 0;
  border-bottom: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.agent-dock-transcript {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  padding: var(--space-4);
  font-size: var(--font-size-xs);
  line-height: var(--line-height-base);
}

/* ──────────────────────────────────────────
   Message styling
   ────────────────────────────────────────── */
.agent-dock-message {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  padding: var(--space-3);
  border-radius: var(--radius-md);
  background: var(--color-surface-2);
  border: 1px solid var(--color-border);
  animation: slideUp var(--duration-fast) var(--easing-decelerate);
}

.agent-dock-message.agent  { background: rgba(37, 99, 235, 0.04); border-color: rgba(37, 99, 235, 0.15); }
.agent-dock-message.user   { background: rgba(6, 182, 212, 0.04); border-color: rgba(6, 182, 212, 0.15); margin-left: var(--space-2); }
.agent-dock-message.system { background: rgba(75, 85, 99, 0.06); border-color: rgba(75, 85, 99, 0.15); }
.agent-dock-message.error  { background: rgba(220, 38, 38, 0.06); border-color: rgba(220, 38, 38, 0.2); }

.agent-dock-message-type {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-secondary);
  opacity: 0.7;
}

.agent-dock-message-content {
  color: var(--color-text-primary);
  word-wrap: break-word;
  word-break: break-word;
  white-space: pre-wrap;
  font-family: var(--font-family-mono);
  font-size: var(--font-size-xs);
  line-height: 1.4;
  max-height: 150px;
  overflow-y: auto;
}

.agent-dock-message-time {
  font-size: var(--font-size-2xs);
  color: var(--color-text-tertiary);
  opacity: 0.6;
}

/* ──────────────────────────────────────────
   Composer area
   ────────────────────────────────────────── */
.agent-dock-composer-area {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  background: var(--color-surface-1);
  border-top: 1px solid var(--color-border);
}

/* ──────────────────────────────────────────
   Scrollbar styling
   ────────────────────────────────────────── */
.agent-dock-transcript::-webkit-scrollbar { width: 4px; }
.agent-dock-transcript::-webkit-scrollbar-track { background: transparent; }
.agent-dock-transcript::-webkit-scrollbar-thumb { background: var(--color-border-strong); border-radius: 2px; }
.agent-dock-message-content::-webkit-scrollbar { width: 3px; }
.agent-dock-message-content::-webkit-scrollbar-track { background: transparent; }
.agent-dock-message-content::-webkit-scrollbar-thumb { background: rgba(75, 85, 99, 0.3); border-radius: 2px; }

/* ──────────────────────────────────────────
   Action bar (kept for Cancel icon if ever needed directly)
   ────────────────────────────────────────── */
.agent-dock-actions {
  display: flex;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: var(--color-surface-2);
  border-top: 1px solid var(--color-border);
  align-items: center;
}

/* ──────────────────────────────────────────
   Mobile — full-width bottom sheet
   ────────────────────────────────────────── */
@media (max-width: 799px) {
  :root {
    --dock-width: 100%;
    --dock-open-h: 55vh;
    --dock-header-h: 40px;
  }

  .agent-dock {
    right: 0;
    left: 0;
    width: 100%;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    border-left: none;
    border-right: none;
  }

  /* Push page content up by the header height so the dock doesn't overlap */
  body {
    padding-bottom: var(--dock-header-h);
  }

  /* When expanded, push content up more */
  body:has(.agent-dock:not(.minimized)) {
    padding-bottom: var(--dock-open-h);
  }

  .agent-dock-header {
    padding: 0 14px;
  }

  .agent-dock-menu {
    /* On mobile the menu should open upward, keep it within screen */
    right: 0;
    left: auto;
    min-width: 180px;
  }
}

/* ──────────────────────────────────────────
   Animations
   ────────────────────────────────────────── */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(4px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ──────────────────────────────────────────
   Reduced motion
   ────────────────────────────────────────── */
@media (prefers-reduced-motion: reduce) {
  .agent-dock,
  .agent-dock-message,
  .agent-dock-dot,
  .agent-dock-chevron svg {
    animation: none;
    transition: none;
  }
}
